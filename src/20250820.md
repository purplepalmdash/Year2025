# 20250820
### 1. idv enhancement
enhancement under other md file.    

```
"Re-Size BAR Support"（也称为Resizable BAR或ReBAR）是一个BIOS选项，用于启用PCIe设备的Resizable BAR功能。该功能允许CPU直接访问GPU的整个视频内存（VRAM），而不是传统上限制在较小的256MB块中，从而优化系统资源分配，提高游戏和图形密集型应用的性能，例如减少数据传输延迟并提升帧率。

对于RTX-A6000在KVM下的GPU透传（passthrough），需要关闭此选项的原因是：当启用ReBAR时，GPU的基地址寄存器（BAR）会被设置为匹配其VRAM大小（A6000为48GB），这要求分配大量的连续内存地址空间。然而，在QEMU/KVM虚拟化环境中，默认的OVMF/EDK2固件提供的MMIO（内存映射I/O）地址空间通常限制在32GB左右，无法容纳如此大的BAR大小，导致地址分配冲突、虚拟机启动失败或黑屏等问题。如果不关闭ReBAR，透传过程会因资源不足而中断。

RTX-4070（12GB VRAM）和RTX-3050（4GB或8GB VRAM）在ReBAR开启时能成功透传，而A6000（48GB VRAM）不能，主要原因是VRAM大小的差异导致的BAR分配需求不同。较小的VRAM意味着BAR大小也较小（例如12GB以下），这可以轻松适应KVM默认的32GB MMIO地址空间，而不会引起冲突。A6000的48GB VRAM会要求更大的BAR（超过32GB限制），导致地址空间不足和透传失败。此外，RTX-4070基于Ada Lovelace架构，可能在固件或驱动层面有更好的虚拟化兼容性优化，而A6000作为Ampere架构的专业工作站卡（类似于RTX 3090），在高VRAM配置下更容易遇到这些问题。
```
### 2. Queens(zun)
Create 3 nodes, using 192.168.160.0/24 networking, based on centos7.     

Create bridge via:     

```
nmcli con add type bridge ifname br0
nmcli con modify bridge-br0 bridge.stp no
nmcli con modify bridge-br0 ipv4.method manual ipv4.address "192.168.160.13/24" ipv4.gateway "192.168.160.1" ipv4.dns 223.5.5.5 
nmcli con add type bridge-slave ifname eth0 master bridge-br0
nmcli con del eth0
reboot
```
(All nodes) configuration for hosts:     

```
cat >>/etc/hosts<<EOF

# controller
192.168.160.11    controller

# compute
192.168.160.12    compute1
192.168.160.13    compute2
EOF
yum install -y centos-release-openstack-queens
```
(Controller) configuration for repo:    

```
cd /etc/yum.repos.d
vim CentOS-OpenStack-queens.repo 
baseurl=https://mirrors.ustc.edu.cn/centos-vault/7.9.2009/cloud/x86_64/openstack-queens/
vim CentOS-Ceph-Luminous.repo 
baseurl=https://mirrors.ustc.edu.cn/centos-vault/7.9.2009/storage/x86_64/ceph-nautilus/
vim CentOS-QEMU-EV.repo 
baseurl=https://mirrors.ustc.edu.cn/centos-vault/7.9.2009/virt/x86_64/kvm-common/
yum makecache
yum install -y python-openstackclient 
scp CentOS-OpenStack-queens.repo CentOS-Ceph-Luminous.repo CentOS-QEMU-EV.repo compute1:/etc/yum.repos.d/
scp CentOS-OpenStack-queens.repo CentOS-Ceph-Luminous.repo CentOS-QEMU-EV.repo compute2:/etc/yum.repos.d/
```
