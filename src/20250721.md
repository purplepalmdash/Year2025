# 20250721
### 1. CentOS queens zun deployment
3 nodes with replaced docker images(`rocky->queens`):      

```
[root@queen1 kolla]# docker images | grep zun | grep rocky
kolla/centos-source-zun-compute                   rocky           384975e8ebb3   5 years ago     1.07GB
kolla/centos-source-zun-api                       rocky           4293ca2bb6b1   5 years ago     1.04GB
[root@queen1 kolla]# docker images | grep kuryr | grep rocky
kolla/centos-source-kuryr-libnetwork              rocky           1eb87543a31b   5 years ago     953MB
```
When create ext nework , failed  with :       

![./images/2025_07_21_09_26_16_648x206.jpg](./images/2025_07_21_09_26_16_648x206.jpg)

issue:     

```
Unable to establish connection to http://10.171.172.24:9517/v1/containers?run=true: ('Connection aborted.', error(110, '\xe8\xbf\x9e\xe6\x8e\xa5\xe8\xb6\x85\xe6\x97\xb6'))
Failed to discover available identity versions when contacting http://10.171.172.24:35357/v3. Attempting to parse version from URL.
Unable to establish connection to http://10.171.172.24:35357/v3/auth/tokens: HTTPConnectionPool(host='10.171.172.24', port=35357): Max retries exceeded with url: /v3/auth/tokens (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f60a3d8c0d0>: Failed to establish a new connection: [Errno 113] \xe6\xb2\xa1\xe6\x9c\x89\xe5\x88\xb0\xe4\xb8\xbb\xe6\x9c\xba\xe7\x9a\x84\xe8\xb7\xaf\xe7\x94\xb1',))
Failed to discover available identity versions when contacting http://10.171.172.24:35357/v3. Attempting to parse version from URL.
Unable to establish connection to http://10.171.172.24:35357/v3/auth/tokens: HTTPConnectionPool(host='10.171.172.24', port=35357): Max retries exceeded with url: /v3/auth/tokens (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f529babd0d0>: Failed to establish a new connection: [Errno 113] \xe6\xb2\xa1\xe6\x9c\x89\xe5\x88\xb0\xe4\xb8\xbb\xe6\x9c\xba\xe7\x9a\x84\xe8\xb7\xaf\xe7\x94\xb1',))

```
### 2. CentOS queens zun deployment(linuxbridge mode)
The same issue as above./     
### 3. dadfailed issue
issue:      

```
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:00:f1:14:6a brd ff:ff:ff:ff:ff:ff
    inet 10.171.172.23/24 brd 10.171.172.255 scope global noprefixroute eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::43ae:554e:9564:d787/64 scope link tentative noprefixroute dadfailed 
       valid_lft forever preferred_lft forever
    inet6 fe80::f07e:e9f6:352b:994c/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever

```

solved via:     
```
[root@queen3 ~]# cat /etc/machine-id 
334e69d6bacf423a8b821ba7a3cdd9a4
[root@queen3 ~]# sudo chmod ugo+w /etc/machine-id
[root@queen3 ~]# sudo cat /dev/null > /etc/machine-id
[root@queen3 ~]# sudo systemd-machine-id-setup
Initializing machine ID from KVM UUID.
[root@queen3 ~]# sudo chmod ugo-w /etc/machine-id
[root@queen3 ~]# cat /etc/machine-id 
ec8dd68a129e4eeab9b31bbf9e5701a5
```
### 4. enable virsh console
Via:     

```
sudo systemctl enable serial-getty@ttyS0.service --now
```
Then `virsh console vmname` you could get a console login.    

### 5. redeploy queens(ubuntu)
Use docker images then retag:       

```
docker load<1804zunphoneimages.tar && docker load<etcd.tar && docker load<rocky.tar
docker rmi kolla/ubuntu-source-zun-api:queens kolla/ubuntu-source-zun-api:queensback kolla/ubuntu-source-zun-compute:queens kolla/ubuntu-source-zun-compute:queensback && docker tag kolla/ubuntu-source-zun-compute:rocky kolla/ubuntu-source-zun-compute:queens && docker tag kolla/ubuntu-source-zun-api:rocky kolla/ubuntu-source-zun-api:queens && docker rmi kolla/ubuntu-source-kuryr-libnetwork:queens && docker tag kolla/ubuntu-source-kuryr-libnetwork:rocky kolla/ubuntu-source-kuryr-libnetwork:queens
```
