# 20250818
### 1. idv(rtx passthrough)
#### 1.1 bios configuration
Disable `Internal Graphics`(If present):     

![./images/2025_08_18_09_05_59_612x371.jpg](./images/2025_08_18_09_05_59_612x371.jpg)

![./images/2025_08_18_09_06_13_509x176.jpg](./images/2025_08_18_09_06_13_509x176.jpg)

Boot from CD(or external usb disk):     

![./images/2025_08_18_09_07_12_596x429.jpg](./images/2025_08_18_09_07_12_596x429.jpg)

Save and exit, reboot to installation.    

#### 1.2 System Installation/Configuration
Choose `Install Ubuntu`:     

![./images/2025_08_18_09_08_24_943x213.jpg](./images/2025_08_18_09_08_24_943x213.jpg)

Nvidia card won't work(ubuntu18.04 didn't have the device driver).    

Use internal graphical card for installation:     

![./images/2025_08_18_09_26_00_797x467.jpg](./images/2025_08_18_09_26_00_797x467.jpg)

Manually install deriver under installed system:      

```
# ./NVIDIA-Linux-x86_64-580.76.05.run  
# reboot
root@idvgen12:~# lspci -vvnn -s 01:00.0 | grep 'Kernel driver in'
	Kernel driver in use: nvidia
root@idvgen12:~# lspci | grep -i vga
01:00.0 VGA compatible controller: NVIDIA Corporation Device 2786 (rev a1)
09:00.0 VGA compatible controller: ASPEED Technology, Inc. ASPEED Graphics Family (rev 52)
```
Change default grub configuration:     

```
# vim /etc/default/grub
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash iommu=pt kvm.ignore_msrs=1 intel_iommu=on intel_iommu=pt video=efifb:off,vesafb:off initcall_blacklist=sysfb_init modprobe.blacklist=ast"
# update-grub2 && reboot
```
####  1.3 vfio hooks debugging
adjust for making it workable for nvidia card:      

```
root@idvgen12:~# cat /bin/detectgpu.sh | grep -i nvidia
vgaid=`lspci | grep -i vga | grep -i nvidia | awk {'print $1'}`
reserveid=`lspci | grep -i vga | grep -i nvidia | awk -F ':' {'print $1'}`

/bin/vfio-startup.sh and /bin/vfio-teardown.sh remains the same.    
```
#### 1.4 vm preparation
vm disk preparation:      

```
root@idvgen12:~# mv /home/test/little_win10.qcow2 /var/lib/libvirt/images/
root@idvgen12:~# qemu-img create -f qcow2 -b /var/lib/libvirt/images/little_win10.qcow2 -F qcow2 /var/lib/libvirt/images/nvidia_win10.qcow2
```
Import disk and generate the vm:     

![./images/2025_08_18_10_44_35_928x528.jpg](./images/2025_08_18_10_44_35_928x528.jpg)

minimum configuration:      

![./images/2025_08_18_10_44_54_684x545.jpg](./images/2025_08_18_10_44_54_684x545.jpg)

Enable remote desktop:      

![./images/2025_08_18_10_45_37_568x429.jpg](./images/2025_08_18_10_45_37_568x429.jpg)

Adjust the processor for setting 12 cores:     

![./images/2025_08_18_10_46_18_563x412.jpg](./images/2025_08_18_10_46_18_563x412.jpg)

12=6core/2threads:     

![./images/2025_08_18_10_49_26_515x339.jpg](./images/2025_08_18_10_49_26_515x339.jpg)


Change to e1000 ethernet card for networking:    

![./images/2025_08_18_10_47_23_500x272.jpg](./images/2025_08_18_10_47_23_500x272.jpg)

`192.168.123.142` for connecting:     

![./images/2025_08_18_10_48_15_473x269.jpg](./images/2025_08_18_10_48_15_473x269.jpg)

#### 1.5 vm adjust.
Add nvidia card, keyboard, mouse:     

![./images/2025_08_18_10_53_05_355x140.jpg](./images/2025_08_18_10_53_05_355x140.jpg)

vfio hook:    

```
root@idvgen12:~# cat /etc/libvirt/hooks/qemu  | grep ^INSTANCE
INSTANCE="nvidia_win10"
# systemctl restart libvirtd
# virsh start nvidia_win10
```
kvm output:     

![./images/2025_08_18_10_55_50_757x630.jpg](./images/2025_08_18_10_55_50_757x630.jpg)

ssh forwarding to windows' remote desktop:      

```
root@idvgen12:/etc/apt/sources.list.d# ssh -L 0.0.0.0:13389:192.168.123.142:3389 test@192.168.1.101
```

Wait for windows update for updating the system:    

![./images/2025_08_18_10_59_26_394x271.jpg](./images/2025_08_18_10_59_26_394x271.jpg)

also using virtio iso for updating the system driver   

Add the python-qt5 scripts, but this script won't start, until:        

```
usermod -aG libvirt test
``` 
Also comment all of the `sudo` related items under `/opt/bgok_close.py`.    

### 2. redo nvidia-idv(256G ssd)

![./images/2025_08_18_11_43_24_710x626.jpg](./images/2025_08_18_11_43_24_710x626.jpg)

![./images/2025_08_18_11_44_26_663x431.jpg](./images/2025_08_18_11_44_26_663x431.jpg)

rescuezilla clone:    

![./images/2025_08_18_14_52_36_607x260.jpg](./images/2025_08_18_14_52_36_607x260.jpg)

### 3. rescuzilla
选择语言：    

![./images/2025_08_18_15_08_17_670x512.jpg](./images/2025_08_18_15_08_17_670x512.jpg)

点击`还原`:      

![./images/2025_08_18_15_09_03_602x509.jpg](./images/2025_08_18_15_09_03_602x509.jpg)

还原镜像所在位置:      

![./images/2025_08_18_15_09_53_537x393.jpg](./images/2025_08_18_15_09_53_537x393.jpg)

选择`nvidiaidv-2025-08-18xxxx`    

![./images/2025_08_18_15_10_33_1038x403.jpg](./images/2025_08_18_15_10_33_1038x403.jpg)

选择需要还原到的硬盘:     

![./images/2025_08_18_15_11_16_798x265.jpg](./images/2025_08_18_15_11_16_798x265.jpg)

保持默认:     

![./images/2025_08_18_15_11_32_1055x538.jpg](./images/2025_08_18_15_11_32_1055x538.jpg)

点击下一步，并选择确认后开始还原:      

![./images/2025_08_18_15_12_00_997x393.jpg](./images/2025_08_18_15_12_00_997x393.jpg)

还原过程, 并查看其进度:    

![./images/2025_08_18_15_14_03_919x369.jpg](./images/2025_08_18_15_14_03_919x369.jpg)

![./images/2025_08_18_15_19_43_586x444.jpg](./images/2025_08_18_15_19_43_586x444.jpg)

点击桌面的gparted, 扩充磁盘:     

![./images/2025_08_18_15_20_14_1093x406.jpg](./images/2025_08_18_15_20_14_1093x406.jpg)

切换到sda:     

![./images/2025_08_18_15_20_31_666x296.jpg](./images/2025_08_18_15_20_31_666x296.jpg)

扩充到100%:     

![./images/2025_08_18_15_20_47_678x408.jpg](./images/2025_08_18_15_20_47_678x408.jpg)

确认应用:      

![./images/2025_08_18_15_21_02_527x350.jpg](./images/2025_08_18_15_21_02_527x350.jpg)

点击关闭后，重启      


### 4. bios for silver

![./images/2025_08_18_17_40_59_994x515.jpg](./images/2025_08_18_17_40_59_994x515.jpg)

A6000 maybe need passthrough vbt files.    
