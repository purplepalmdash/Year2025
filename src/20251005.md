# 20251005
### 1. ubuntu180406 kernel build
Create image and download iso:    

```
qemu-img create -f qcow2 ubuntu180406.qcow2 50G
Formatting 'ubuntu180406.qcow2', fmt=qcow2 cluster_size=65536 extended_l2=off compression_type=zlib size=53687091200 lazy_refcounts=off refcount_bits=16
axel https://mirrors.ustc.edu.cn/ubuntu-cdimage/releases/18.04.6/release/ubuntu-18.04.6-server-arm64.iso
```
Install with serial port, no vnc/spice or qxl/virtiogpu    

Steps:   

```
apt update -y
apt upgrade -y
reboot
```
Refers to `https://developer.huawei.com/home/forum/kunpeng/thread-0291139148471073001-1-1.html`     

```
sudo apt install -y build-essential dpkg dpkg-dev libncurses5-dev openssl libssl-dev libpciaccess0 pkg-config bison flex libelf-dev libdrm-amdgpu1 xserver-xorg-video-amdgpu
axel https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v5.x/linux-5.15.98.tar.xz
tar xJvf linux-5.15.98.tar.xz 
vim enable_AMD6800_6600_5.15.98.patch
```
Get the 5.15 config file from(ubuntu22.04):    

```
sudo docker run -it -v /home/test/Code/config:/config ubuntu:22.04 /bin/bash
in docker: 
apt update -y
apt install -y vim
cd /config
 apt-get install --download-only linux-image-generic-5.15
 cp /var/cache/apt/archives/linux-image-5.15.0-157-generic_5.15.0-157.167_arm64.deb .

Cannot get the config from the deb extraction.   
```

directly install and get the config from docker:     

```
root@ba6e07c10b79:/config# cp /boot/config-5.15.0-157-generic .

```
Build:    

```
mkdir build
mv .config build/.config
make mrproper
time make LOCALVERSION="jyz" -j10 O=./build bindeb-pkg
dpkg-buildpackage: info: binary-only upload (no source included)
make[1]: Leaving directory '/home/test/Code/linux-5.15.98/build'
                                                                                                                         
real    12m51.518s                            
user    105m39.793s                   
sys     11m47.658s  

sudo apt install ./linux-image-5.15.98jyz_5.15.98jyz-1_arm64.deb
sudo reboot

After reboot

```
Run testing for redroid:     

```
test@ubuntu:~$ uname -r
5.15.98lm
test@ubuntu:~$  sudo docker run -itd --rm --privileged -p 5555:5555     redroid/redroid:12.0.0_64only-latest
Unable to find image 'redroid/redroid:12.0.0_64only-latest' locally
12.0.0_64only-latest: Pulling from redroid/redroid
d84d394d90eb: Pull complete 
Digest: sha256:a6c464bbedcf1dcb67dbf91f329fbb19bee5b50631f0ca6bda6ed7c41b0e64e2
Status: Downloaded newer image for redroid/redroid:12.0.0_64only-latest
7e370f79e8f3147efcb69f9e99ab9be5b85af747684890c863e198b8d8c0da14
test@ubuntu:~$ sudo docker ps
CONTAINER ID   IMAGE                                  COMMAND                  CREATED          STATUS          PORTS                                       NAMES
7e370f79e8f3   redroid/redroid:12.0.0_64only-latest   "/init qemu=1 androiâ€¦"   50 seconds ago   Up 48 seconds   0.0.0.0:5555->5555/tcp, :::5555->5555/tcp   nifty_kalam
test@ubuntu:~$ sudo docker exec -it 7e370f sh
7e370f79e8f3:/ # getprop  | grep boot | grep com                                                                                                                                            
[dev.bootcomplete]: [1]
[ro.boottime.vendor.hwcomposer-2-1]: [295427933557]
[sys.boot_completed]: [1]
[sys.bootstat.first_boot_completed]: [1]

```
